"0","# Open a PDF device"
"0","pdf(""output/cca_km_plots.pdf"")"
"0",""
"0","# Loop through each variable and save its plot on a separate page"
"0","for (variable in variables_of_interest) {"
"0","  legend_label <- legend_labels_cca[[variable]]"
"0","  logrank_p <- log_rank_results_df$logrank_p_value[log_rank_results_df$variable == variable]"
"0","  cox_HR <- coxph_df_cca$cox_hazard_ratio[coxph_df_cca$column_names == variable]"
"0","  "
"0","  # Extract the variable values from the dataframe"
"0","  variable_values <- cca_df[[variable]]"
"0","  "
"0","  # Make sure the event status is logical"
"0","  cca_df$Event_Status <- as.logical(cca_df$Event_Status)"
"0","  "
"0","  # Create the survival object"
"0","  surv_obj <- Surv(time = cca_df$time_diff_months, event = cca_df$Event_Status)"
"0","  "
"0","  # Fit Kaplan-Meier model"
"0","  km_fit <- survfit(surv_obj ~ variable_values, data = cca_df)"
"0","  "
"0","  # Convert p-value and hazard ratio to scientific notation with 3 significant figures"
"0","  logrank_p <- format(logrank_p, scientific = TRUE, digits = 3)"
"0","  cox_HR <- format(cox_HR, scientific = TRUE, digits = 3)"
"0","  "
"0","  # Create Kaplan-Meier plot"
"0","  km_plot <- ggsurvplot("
"0","    km_fit,"
"0","    data = cca_df,"
"0","    title = paste(""Kaplan-Meier Curve of  Cholangiocarcinoma by"", variable),"
"0","    censor = TRUE,"
"0","    xlab = ""Time (Months)"","
"0","    ylab = ""Survival Probability"","
"0","    conf.int = TRUE,"
"0","    conf.int.style = ""step"","
"0","    conf.int.alpha = 0.2,"
"0","    surv.median.line = ""hv"","
"0","    xlim = c(0, 24),"
"0","    break.time.by = 3,"
"0","    breaks = seq(0, 24, by = 3),"
"0","    surv.scale = ""percent"","
"0","    legend.labs = c(legend_label[1], legend_label[2]),  # Assuming two groups for now"
"0","    palette = ""lancet"""
"0","  )"
"0","  "
"0","  # Add annotation to the plot"
"0","  km_plot <- km_plot$plot + annotate("
"0","    ""text"", x = 0, y = 0.05, "
"0","    label = paste(""Log-Rank p-value:"", logrank_p, ""\nHazard Ratio:"", cox_HR), "
"0","    hjust = 0, vjust = 0"
"0","  )"
"0","  "
"0","  # Apply custom theme"
"0","  km_plot <- km_plot + ggsurvfit::theme_ggsurvfit_KMunicate()"
"0","  "
"0","  # Save the plot on a separate page"
"0","  print(km_plot)"
"0","}"
