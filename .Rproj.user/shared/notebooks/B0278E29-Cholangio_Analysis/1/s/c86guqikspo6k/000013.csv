"0","# Open a PDF device"
"0","pdf(""output/Cholangio_Output/resistant_km_plots.pdf"")"
"0",""
"0","# Define the variables of interest for the resistant dataset"
"0","variables_of_interest_resistant <- c(""Albumin_3.5"", ""LMR_2.1"", ""MON_0.8"", ""LY_1.5"", ""ANC_4"", ""ANC_8"", "
"0","                                     ""NLR_3"", ""NLR_5"", ""PLT_300"", ""Alk_Phos_135"", ""Alk_Phos_200"", "
"0","                                     ""Age_60"", ""Age_65"", ""Age_70"")"
"0",""
"0","for (variable_resistant in variables_of_interest_resistant) {"
"0","  legend_label_resistant <- legend_labels_resistant[[variable_resistant]]"
"0","  logrank_p_resistant <- log_rank_results_df_resistant$logrank_p_value[log_rank_results_df_resistant$variable == variable_resistant]"
"0","  cox_HR_resistant <- coxph_df_resistant$cox_hazard_ratio[coxph_df_resistant$column_names == variable_resistant]"
"0","  "
"0","  # Extract the variable values from the resistant dataframe"
"0","  variable_values_resistant <- resistant_df[[variable_resistant]]"
"0","  "
"0","  # Make sure the event status is logical"
"0","  resistant_df$Event_Status <- as.logical(resistant_df$Event_Status)"
"0","  "
"0","  # Create the survival object for the resistant dataset"
"0","  surv_obj_resistant <- Surv(time = resistant_df$time_diff_months, event = resistant_df$Event_Status)"
"0","  "
"0","  # Fit Kaplan-Meier model for the resistant dataset"
"0","  km_fit_resistant <- survfit(surv_obj_resistant ~ variable_values_resistant, data = resistant_df)"
"0","  "
"0","  # Convert p-value and hazard ratio to scientific notation with 3 significant figures"
"0","  logrank_p_resistant <- format(logrank_p_resistant, scientific = TRUE, digits = 3)"
"0","  cox_HR_resistant <- format(cox_HR_resistant, scientific = TRUE, digits = 3)"
"0","  "
"0","  # Create Kaplan-Meier plot for the resistant dataset"
"0","  km_plot_resistant <- ggsurvplot("
"0","    km_fit_resistant,"
"0","    data = resistant_df,"
"0","    title = paste(""Kaplan-Meier Curve of Resistant Cholangiocarcinoma by"", variable_resistant),"
"0","    censor = TRUE,"
"0","    xlab = ""Time (Months)"","
"0","    ylab = ""Survival Probability"","
"0","    conf.int = TRUE,"
"0","    conf.int.style = ""step"","
"0","    conf.int.alpha = 0.2,"
"0","    surv.median.line = ""hv"","
"0","    xlim = c(0, 24),"
"0","    break.time.by = 3,"
"0","    breaks = seq(0, 24, by = 3),"
"0","    surv.scale = ""percent"","
"0","    legend.labs = legend_label_resistant,  # Assuming two groups for now"
"0","    palette = ""lancet"""
"0","  )"
"0","  "
"0","  # Add annotation to the resistant dataset plot"
"0","  km_plot_resistant <- km_plot_resistant$plot + annotate("
"0","    ""text"", x = 0, y = 0.05, "
"0","    label = paste(""Log-Rank p-value:"", logrank_p_resistant, ""\nHazard Ratio:"", cox_HR_resistant), "
"0","    hjust = 0, vjust = 0"
"0","  )"
"0","  "
"0","  # Apply custom theme"
"0","  km_plot_resistant <- km_plot_resistant + ggsurvfit::theme_ggsurvfit_KMunicate()"
"0","  "
"0","  # Display the plot for the resistant dataset"
"0","  print(km_plot_resistant)"
"0","}"
