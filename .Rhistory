risk.table.title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
xlim = c(0, 24),
break.time.by = 3,
breaks = seq(0, 24, by = 3),
risk.table = TRUE,
surv.scale = "percent",
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
pval = TRUE,
risk.table.title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
xlim = c(0, 24),
break.time.by = 3,
breaks = seq(0, 24, by = 3),
risk.table = TRUE,
surv.scale = "percent",
risk.table.height = 0.5,
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
pval = TRUE,
risk.table.title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
xlim = c(0, 24),
break.time.by = 3,
breaks = seq(0, 24, by = 3),
risk.table = TRUE,
surv.scale = "percent",
risk.table.height = 0.5,
risk.table.fontsize = 0.2,
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
pval = TRUE,
risk.table.title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
xlim = c(0, 24),
break.time.by = 3,
breaks = seq(0, 24, by = 3),
risk.table = TRUE,
surv.scale = "percent",
risk.table.height = 0.5,
risk.table.fontsize = 10,
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
pval = TRUE,
risk.table.title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
xlim = c(0, 24),
break.time.by = 3,
breaks = seq(0, 24, by = 3),
risk.table = TRUE,
surv.scale = "percent",
risk.table.height = 0.5,
risk.table.fontsize = 6,
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
pval = TRUE,
risk.table.title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
xlim = c(0, 24),
break.time.by = 3,
breaks = seq(0, 24, by = 3),
risk.table = TRUE,
surv.scale = "percent",
risk.table.height = 0.5,
risk.table.fontsize = 3,
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
pval = TRUE,
risk.table.title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
xlim = c(0, 24),
break.time.by = 3,
breaks = seq(0, 24, by = 3),
risk.table = TRUE,
surv.scale = "percent",
risk.table.height = 0.5,
fontsize = 3,
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Define the variable of interest
variable <- "Prognostic_Score_ALAN_category"
# Extract legend labels for the variable
legend_label <- legend_labels_cca[[variable]]
# Extract Log-Rank p-value and Hazard Ratio for the variable
logrank_p <- log_rank_results_df$logrank_p_value[log_rank_results_df$variable == variable]
cox_HR <- coxph_df_cca$cox_hazard_ratio[coxph_df_cca$column_names == variable]
# Extract variable values from the dataframe
variable_values <- cca_df[[variable]]
# Create the survival object
surv_obj <- Surv(time = cca_df$time_diff_months, event = cca_df$Event_Status)
# Fit Kaplan-Meier model
km_fit <- survfit(surv_obj ~ variable_values, data = cca_df)
# Convert p-value and hazard ratio to scientific notation with 3 significant figures
logrank_p <- format(logrank_p, scientific = TRUE, digits = 3)
cox_HR <- format(cox_HR, scientific = TRUE, digits = 3)
# Create Kaplan-Meier plot
km_plot <- ggsurvplot(
km_fit,
data = cca_df,
risk.table.title = paste("Kaplan-Meier Curve of Advanced Intrahepatic Cholangiocarcinoma by ALAN Score"),
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
conf.int = TRUE,
conf.int.style = "step",
conf.int.alpha = 0.2,
pval = TRUE,
risk.table = TRUE,
surv.median.line = "hv",
xlim = c(0, 24),
break.time.by = 3,
breaks = seq(0, 24, by = 3),
surv.scale = "percent",
legend.labs = legend_label,  # Assuming three groups for "Prognostic_Score_ALAN_category"
palette = "lancet"
)
# Add annotation to the plot
#km_plot <- km_plot$plot + annotate(
#"text", x = 0, y = 0.05,
#label = paste("Log-Rank p-value:", logrank_p, "\nHazard Ratio:", cox_HR),
#hjust = 0, vjust = 0
#)
# Apply custom theme
km_plot <- km_plot + ggsurvfit::theme_ggsurvfit_KMunicate()
# Display the plot
print(km_plot)
#ggsave(filename = "output/cholangio_ALAN_kmplot.png", plot = km_plot, width = 10, height = 6)
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
pval = TRUE,
title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma
Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
xlim = c(0, 24),
break.time.by = 3,
breaks = seq(0, 24, by = 3),
risk.table = TRUE,
surv.scale = "percent",
risk.table.height = 0.5,
fontsize = 3,
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
pval = TRUE,
risk.table.title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma
Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
xlim = c(0, 24),
break.time.by = 3,
breaks = seq(0, 24, by = 3),
risk.table = TRUE,
surv.scale = "percent",
risk.table.height = 0.5,
fontsize = 3,
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
pval = TRUE,
risk.table.title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma
Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
xlim = c(0, 24),
break.time.by = 3,
breaks = seq(0, 24, by = 3),
risk.table = TRUE,
surv.scale = "percent",
risk.table.height = 0.5,
fontsize = 3,
legend.labs = legend_labels, # Use the modified legend labels
table.col = "strata",
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
pval = TRUE,
risk.table.title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma
Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
xlim = c(0, 24),
break.time.by = 3,
breaks = seq(0, 24, by = 3),
risk.table = TRUE,
surv.scale = "percent",
risk.table.height = 0.5,
fontsize = 3,
legend.labs = legend_labels, # Use the modified legend labels
risk.table.col = "strata",
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
