# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
title = "Kaplan Meier Curve of Survival by Cancer Status and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
#conf.int = TRUE,
#pval = TRUE,
#conf.int.style = "step",
#conf.int.alpha = 0.2,
ggtheme = theme_minimal(),
surv.median.line = "hv",
#xlim = c(0, 24),
break.time.by = 12,
surv.scale = "percent",
legend.labs = c("NPT-CCA_ALAN Score=0", "NPT-CCA_ALAN Score=1-2", "NPT-CCA_ALAN Score=3-4",
"Resistant-CCA_ALAN Score=0", "Resistant-CCA_ALAN Score=1-2", "Resistant-CCA_ALAN Score=3-4"),
palette = "lancet"
)
# Add annotations for p-values and hazard ratios
p_values_labels <- paste("P-value:", round(p_values, 4))
hazard_ratios_labels <- paste("Hazard Ratio:", round(hazard_ratios, 4))
kmplot_group <- kmplot_group$plot + annotate(
"text", x = 0, y = 0.05,
label = paste(p_values_labels, "\n", hazard_ratios_labels),
hjust = 0, vjust = 0
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT-CCA ALAN Score = 0", "NPT-CCA ALAN Score = 1-2", "NPT-CCA ALAN Score = 3-4",
"Resistant-CCA ALAN Score = 0", "Resistant-CCA ALAN Score = 1-2", "Resistant-CCA ALAN Score = 3-4"),
" (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
title = "Kaplan Meier Curve of Survival by Cancer Status and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
conf.int = TRUE,
pval = TRUE,
conf.int.style = "step",
conf.int.alpha = 0.2,
ggtheme = theme_minimal(),
surv.median.line = "hv",
xlim = c(0, 24),
break.time.by = 3,
risk.table = TRUE,
surv.scale = "percent",
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Add annotations for p-values and hazard ratios
p_values_labels <- paste("P-value:", round(p_values, 4))
hazard_ratios_labels <- paste("Hazard Ratio:", round(hazard_ratios, 4))
kmplot_group <- kmplot_group$plot + annotate(
"text", x = 0, y = 0.05,
label = paste(p_values_labels, "\n", hazard_ratios_labels),
hjust = 0, vjust = 0
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT-CCA ALAN Score = 0", "NPT-CCA ALAN Score = 1-2", "NPT-CCA ALAN Score = 3-4",
"Resistant-CCA ALAN Score = 0", "Resistant-CCA ALAN Score = 1-2", "Resistant-CCA ALAN Score = 3-4"),
" (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
title = "Kaplan Meier Curve of Survival by Cancer Status and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
break.time.by = 12,
risk.table = TRUE,
surv.scale = "percent",
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Add annotations for p-values and hazard ratios
p_values_labels <- paste("P-value:", round(p_values, 4))
hazard_ratios_labels <- paste("Hazard Ratio:", round(hazard_ratios, 4))
kmplot_group <- kmplot_group$plot + annotate(
"text", x = 0, y = 0.05,
label = paste(p_values_labels, "\n", hazard_ratios_labels),
hjust = 0, vjust = 0
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT-CCA ALAN Score = 0", "NPT-CCA ALAN Score = 1-2", "NPT-CCA ALAN Score = 3-4",
"Resistant-CCA ALAN Score = 0", "Resistant-CCA ALAN Score = 1-2", "Resistant-CCA ALAN Score = 3-4"),
" (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
title = "Kaplan Meier Curve of Survival by Cancer Status and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
break.time.by = 12,
risk.table = TRUE,
surv.scale = "percent",
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Add annotations for p-values and hazard ratios separately for each comparison
for (i in 1:length(p_values)) {
annotation_text <- paste("P-value:", round(p_values[i], 4), "\nHazard Ratio:", round(hazard_ratios[i], 4))
kmplot_group <- kmplot_group$plot + annotate(
"text", x = 0, y = 0.05,
label = annotation_text,
hjust = 0, vjust = 0,
nudge_y = i * 0.05
)
}
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT-CCA ALAN Score = 0", "NPT-CCA ALAN Score = 1-2", "NPT-CCA ALAN Score = 3-4",
"Resistant-CCA ALAN Score = 0", "Resistant-CCA ALAN Score = 1-2", "Resistant-CCA ALAN Score = 3-4"),
" (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
title = "Kaplan Meier Curve of Survival by Cancer Status and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
break.time.by = 12,
risk.table = TRUE,
surv.scale = "percent",
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Add annotations for p-values and hazard ratios separately for each comparison
for (i in 1:length(p_values)) {
annotation_text <- paste("P-value:", round(p_values[i], 4), "\nHazard Ratio:", round(hazard_ratios[i], 4))
kmplot_group <- kmplot_group$plot + annotate(
"text", x = 0, y = 0.05,
label = annotation_text,
hjust = 0, vjust = 0,
nudge_y = i * 0.05
)
}
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT-CCA ALAN Score = 0", "NPT-CCA ALAN Score = 1-2", "NPT-CCA ALAN Score = 3-4",
"Resistant-CCA ALAN Score = 0", "Resistant-CCA ALAN Score = 1-2", "Resistant-CCA ALAN Score = 3-4"),
" (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
title = "Kaplan Meier Curve of Survival by Cancer Status and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
break.time.by = 12,
risk.table = TRUE,
surv.scale = "percent",
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT-CCA ALAN Score = 0", "NPT-CCA ALAN Score = 1-2", "NPT-CCA ALAN Score = 3-4",
"Resistant-CCA ALAN Score = 0", "Resistant-CCA ALAN Score = 1-2", "Resistant-CCA ALAN Score = 3-4"),
" (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
title = "Kaplan Meier Curve of Survival by Cancer Status and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
conf.int = TRUE,
conf.int.style = "step",
conf.int.alpha = 0.2,
break.time.by = 12,
risk.table = TRUE,
surv.scale = "percent",
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
" (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
title = "Kaplan Meier Curve of Survival by Cancer Status and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
conf.int = TRUE,
conf.int.style = "step",
conf.int.alpha = 0.2,
break.time.by = 12,
risk.table = TRUE,
surv.scale = "percent",
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
title = "Kaplan Meier Curve of Survival by Cancer Status and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
conf.int = TRUE,
conf.int.style = "step",
conf.int.alpha = 0.2,
break.time.by = 12,
risk.table = TRUE,
surv.scale = "percent",
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
conf.int = TRUE,
conf.int.style = "step",
conf.int.alpha = 0.2,
break.time.by = 12,
risk.table = TRUE,
surv.scale = "percent",
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
break.time.by = 12,
risk.table = TRUE,
surv.scale = "percent",
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
# Combine Cancer_Status and ALAN Score to create six categories
cca_df$Group <- with(cca_df, paste(Cancer_Status, Prognostic_Score_ALAN_category, sep = "_"))
# Perform survival analysis for each category
kmfit_group <- survfit(Surv(time = time_diff_months, event = Event_Status) ~ Group, data = cca_df)
# Calculate p-values and hazard ratios between groups
coxph_group <- coxph(Surv(time_diff_months, Event_Status) ~ Group, data = cca_df)
summary_coxph <- summary(coxph_group)
# Extract p-values and hazard ratios
p_values <- summary_coxph$coefficients[, "Pr(>|z|)"]
hazard_ratios <- exp(summary_coxph$coefficients[, "coef"])
# Get the population size for each group
population_sizes <- table(cca_df$Group)
# Create legend labels with population size
legend_labels <- paste(
c("NPT- CCA; ALAN Score = 0", "NPT- CCA; ALAN Score = 1-2", "NPT- CCA; ALAN Score = 3-4",
"Resistant- CCA; ALAN Score = 0", "Resistant- CCA; ALAN Score = 1-2", "Resistant- CCA; ALAN Score = 3-4"),
": (N =", population_sizes, ")"
)
# Create Kaplan-Meier plot
kmplot_group <- ggsurvplot(
kmfit_group,
data = cca_df,
pval = TRUE,
title = "Kaplan Meier Curve of Advanced Intrahepatic Cholangiocarcinoma Survival by Prior Treatment and ALAN Score",
censor = TRUE,
xlab = "Time (Months)",
ylab = "Survival Probability",
ggtheme = theme_minimal(),
surv.median.line = "hv",
break.time.by = 12,
risk.table = TRUE,
surv.scale = "percent",
legend.labs = legend_labels, # Use the modified legend labels
palette = "lancet"
)
# Customize legend appearance
kmplot_group <-  kmplot_group + ggsurvfit::theme_ggsurvfit_KMunicate(
)
# Display the plot
kmplot_group
